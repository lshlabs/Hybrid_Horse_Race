# Multiplayer Regression Checklist

기준일: 2026-02-22
목적: 간헐적 "다음 라운드 대기 -> 증강 선택 진입 누락" 버그를 재현/고정 검증

## 1) 사전 조건

1. 터미널 A: `npm run emulators`
2. 터미널 B: `npm run dev`
3. 최소 3클라(브라우저 2개 + 시크릿 1개)로 동일 룸 접속
4. 랜딩 설정:
- 플레이어 수: 3
- 라운드 수: 3
- 리롤 수: 임의(권장 2)

## 2) 필수 시나리오

### S1. 정상 라운드 전환
1. 전원 말 선택 확정
2. 전원 증강 선택 확정
3. 레이스 종료 후 전원이 "다음 라운드" 클릭
4. 기대 결과:
- 전원 동시에 `augmentSelection` 진입
- 누락 클라 없음
- `room.currentSet`가 1 증가

### S2. 클릭 타이밍 엇갈림
1. 클라A 먼저 클릭 후 대기
2. 2~5초 후 클라B 클릭
3. 2~5초 후 클라C 클릭
4. 기대 결과:
- 마지막 클릭 시점에 전원 전환
- 클라A/B가 대기 화면에 고정되지 않음

### S3. 전환 직전 새로고침
1. 클라A/B/C 중 한 명을 대기 상태에서 새로고침
2. 재입장 후 동일 roomId로 복귀
3. 기대 결과:
- 현재 라운드 상태로 복구
- 전환 완료 후 다음 라운드 정상 진입
- 최종 결과 페이지에서 라운드 누락 없음

### S4. 3라운드 완주
1. 3라운드 모두 완료
2. 최종 결과 페이지 진입
3. 기대 결과:
- 각 플레이어의 라운드별 기록 3개 모두 표시
- 총점/순위 누락 없음

## 3) 실패 판정 기준

아래 중 하나라도 발생하면 실패:
1. 일부 클라가 waiting overlay에 영구 고정
2. 일부 클라만 다음 라운드 진입
3. 새로고침 복귀 후 라운드 기록 일부 누락
4. `room.status`와 페이지 상태가 불일치

## 4) 수집할 로그

### 브라우저 콘솔
- `RaceScene`에서 `readyNextSet` 요청/응답
- setIndex/room.currentSet 값
- `getSetResult` 백필 실행 여부

### Functions 로그
- `readyNextSet` 호출자 playerId
- `readyPlayers` 길이
- 전환 시점의 `room.currentSet` 증분 로그

## 5) 고정 자동 검증(권장)

아래 항목을 `contract:check` 확장 대상으로 유지:
1. 다중 클라 `readyNextSet` 동시/순차 호출
2. 마지막 호출 시 전원 상태 전환 보장
3. 전환 실패 클라 재시도 시 즉시 회복
4. 최종 결과 라운드 기록 완전성 검증
