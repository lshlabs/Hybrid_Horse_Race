# Project Status Review

기준일: 2026-02-22  
기준점: "배포 완료 = 100%"

## 1. 전체 진행도(추정)

- 종합 진행도: **89%**
- 근거:
  - 핵심 게임 플로우(랜딩→로비→말선택→레이스→결과): 구현 완료, 실시간 동기화 동작
  - Firebase Functions/Firestore 연동: 구현 완료(주요 callable + 룸/플레이어 상태)
  - 서버 권위 레이스 재생 스크립트: 적용 완료(기록/순위 정합성 확보)
  - 다중 클라 안정성/회귀 테스트 자동화: 부분 완료(계약 체크 스크립트 존재)
  - 배포 운영성(모니터링/에러 복구/문서 일관성): 보완 필요

## 2. 로직이 일반적인지(업계 관점)

### 결론
현재 구조는 멀티플레이 게임에서 **일반적으로 사용하는 패턴에 부합**합니다.

### 확인된 패턴
- 룸 기반 세션 + 게스트 세션 토큰(`playerId + sessionToken + joinToken`) 검증
- 서버 권위 상태 전환(`waiting -> horseSelection -> augmentSelection -> racing -> setResult -> finished`)
- 결과 판정 서버 권위화 + 클라이언트 재생 전용(리플레이/키프레임 기반)
- 호스트 이탈 시 위임, 빈 룸 삭제 등 룸 라이프사이클 규칙

## 3. 현재 강점

- 함수 계층에서 주요 액션 검증이 들어가 있어 권한/상태 오염 리스크가 낮아짐
- `maxPlayers`, `roundCount`, `rerollLimit` 등 생성 설정이 서버 모델에 포함됨
- `updatePlayerName`, `setPlayerReady`, `startGame`, `readyNextSet` 등 실시간 협동 흐름이 연결됨
- 레이스는 서버 스크립트 기준으로 기록/순위가 맞는 방향으로 수렴함

## 4. 핵심 개선점(우선순위)

### P0 (배포 전 필수)
1. **README/운영 문서 최신화** `완료`
- 현재 코드 상태와 README 설명(로컬 mock 중심 설명)이 불일치합니다.
- 온보딩/테스트/배포 절차를 현재 구조 기준으로 재정리 필요.

2. **Mock fallback 완전 분리 검증** `완료(운영 경로 DEV 가드 적용)`
- 페이지 코드에 mock 경로가 여전히 남아 있으므로, 운영 모드에서 절대 타지 않게 강제/검증 필요.

3. **라운드 전환 실패 케이스 재현 테스트 고정** `완료(contract:check 확장)`
- 간헐적 "다음 라운드 진입 누락"을 재현 가능한 E2E 시나리오로 고정해야 배포 안정성이 올라갑니다.

### P1
4. **레이스 재생 품질 튜닝 체계화** `진행중(DEV 계측 오버레이 + 1차 보간/스냅 상수 튜닝 적용)`
- 계단감/순간이동 문제는 상당 부분 개선됐지만, 구간별 튐을 계측값(오차/보정횟수) 기반으로 지속 튜닝 필요.

5. **결과 페이지 데이터 복원력 강화** `진행중(최종결과 전 누락 라운드 자동 재시도 추가)`
- 재접속/새로고침 시 라운드별 결과 누락이 없도록 set 결과 조회/백필 로직 검증 강화.

### P2
6. **번들 최적화** `진행중(페이지 lazy loading + manualChunks + Phaser 청크 경고 임계값 조정)`
- 프론트 번들 크기 경고가 지속됩니다. 라우트/씬 단위 코드 스플릿 권장.

7. **패키지/런타임 정리** `진행중(Node runtime doctor + .nvmrc 추가, firebase-functions 업그레이드는 네트워크 제약으로 보류)`
- 함수 런타임(node 22 vs host 24 경고), `firebase-functions` 버전 경고를 정리하면 장기 유지보수성이 좋아집니다.

## 5. 최적화 방안(실행안)

1. 성능
- `RaceScene` 렌더 계층 계측(프레임 드롭, hard snap 빈도, 보정 오차 평균) 상시 출력(DEV)
- keyframe chunk 분할/압축 검토(긴 레이스 대비)

2. 안정성
- 계약 테스트(`contract:check`)에 3클라/다라운드/재접속 케이스 확장
- `invalid-set-index`, `race-script-missing`, `token-expired` 케이스를 UI 에러 코드와 1:1 매핑

3. 운영
- 에뮬레이터/LAN/실배포 실행 가이드를 한 문서로 통합
- Firestore rules/indexes 배포 순서와 롤백 절차 문서화

## 6. 배포 준비도 체크(요약)

- 기능 완성도: 높음
- 동기화 일관성: 높음
- 회귀 안전장치: 중간
- 운영 문서/절차: 중간 이하

즉, **"플레이 가능한 멀티플레이 빌드"는 완성 단계**이고, **"운영 배포 품질"로 올리려면 문서화·회귀검증·운영절차 보강이 남아있는 상태**입니다.

## 7. 추천 다음 액션(3개)

1. `RaceScene` DEV 계측값 기반으로 스냅/보간 상수 1회 튜닝
2. `firebase-functions` 업그레이드 재시도(네트워크 가능 환경) + `contract:check` 회귀 확인
3. 라운드 누락 재현 케이스를 자동 테스트 시나리오로 추가 고정
