# λ°±μ—”λ“ κ°λ° λ΅λ“λ§µ

μ΄ λ¬Έμ„λ” `docs/work-division.md`λ¥Ό κΈ°λ°μΌλ΅ μ‘μ„±λ λ°±μ—”λ“ κ°λ° λ‹¨κ³„λ³„ λ΅λ“λ§µμ…λ‹λ‹¤.

---

## π“‹ ν„μ¬ μ™„λ£ μƒνƒ

### β… μ™„λ£λ μ‘μ—…
- [x] Firebase ν”„λ΅μ νΈ μ΄κΈ° μ„¤μ •
- [x] `createRoom` Cloud Function κµ¬ν„
- [x] κΈ°λ³Έ Firestore λ³΄μ• κ·μΉ™ μ„¤μ •
- [x] νƒ€μ… μ •μ νμΌ (`functions/src/types.ts`)
- [x] κ³µν†µ μ ν‹Έλ¦¬ν‹° ν•¨μ (`functions/src/utils.ts`)
- [x] `joinRoom` ν•¨μ κµ¬ν„
- [x] `setPlayerReady` ν•¨μ κµ¬ν„

---

## π—ΊοΈ Phaseλ³„ κ°λ° λ΅λ“λ§µ

### Phase 1: κΈ°λ³Έ μΈν”„λΌ λ° λ£Έ κ΄€λ¦¬ (1-2μ£Όμ°¨)

**λ©ν‘**: λ£Έ μƒμ„±, μ°Έκ°€, λ‚κ°€κΈ° λ“± κΈ°λ³Έ κΈ°λ¥ μ™„μ„±

#### 1.1 λ£Έ κ΄€λ¦¬ ν•¨μ κµ¬ν„
- [x] `createRoom` - λ£Έ μƒμ„± β…
- [x] `joinRoom` - ν”λ μ΄μ–΄ λ£Έ μ°Έκ°€ β…
- [ ] `leaveRoom` - ν”λ μ΄μ–΄ λ£Έ ν‡΄μ¥
  - ν”λ μ΄μ–΄ μ‚­μ 
  - νΈμ¤νΈκ°€ λ‚κ°€λ©΄ λ£Έ μ‚­μ  λλ” νΈμ¤νΈ μ„μ„
  - λ§μ§€λ§‰ ν”λ μ΄μ–΄κ°€ λ‚κ°€λ©΄ λ£Έ μ‚­μ 
- [ ] `updateRoomSettings` - νΈμ¤νΈ μ „μ© λ£Έ μ„¤μ • λ³€κ²½
  - `setCount`, `rerollLimit` λ³€κ²½
  - νΈμ¤νΈ κ¶ν• κ²€μ¦
  - κ²μ„ μ‹μ‘ μ „μ—λ§ λ³€κ²½ κ°€λ¥

#### 1.2 λ°μ΄ν„° κ²€μ¦ λ° λ³΄μ• κ°•ν™”
- [ ] λ¨λ“  ν•¨μμ— Zod μ¤ν‚¤λ§ μ…λ ¥ κ²€μ¦ μ™„μ„±
- [ ] νΈμ¤νΈ κ¶ν• κ²€μ¦ λ΅μ§ (`isHost` μ ν‹Έλ¦¬ν‹° ν™μ©)
- [ ] ν”λ μ΄μ–΄ μ μ ν• κ²€μ¦ (μµλ€ 8λ…)
- [ ] κ²μ„ μƒνƒ μ „ν™ κ²€μ¦ (μλ»λ μƒνƒ μ „ν™ λ°©μ§€)

#### 1.3 Firestore λ³΄μ• κ·μΉ™ μ™„μ„±
- [ ] μ½κΈ° κ¶ν• κ·μΉ™ (ν”λ μ΄μ–΄λ” μμ‹ μ΄ μ°Έκ°€ν• λ£Έλ§ μ½κΈ° κ°€λ¥)
- [ ] μ“°κΈ° κ¶ν• κ·μΉ™ (Cloud Functionsλ§ μ“°κΈ° κ°€λ¥)
- [ ] λ°μ΄ν„° λ¬΄κ²°μ„± κ²€μ¦ κ·μΉ™

#### 1.4 Firestore μΈλ±μ¤ μ„¤μ •
- [ ] `firestore.indexes.json`μ— λ³µν•© μΈλ±μ¤ μ •μ
- [ ] μΏΌλ¦¬ μ„±λ¥ μµμ ν™”λ¥Ό μ„ν• μΈλ±μ¤ μ¶”κ°€

**μμƒ μ†μ” μ‹κ°„**: 1-2μ£Ό

---

### Phase 2: κ²μ„ μ‹μ‘ λ° μ£Όν–‰ μµμ„± μ„ νƒ (2-3μ£Όμ°¨)

**λ©ν‘**: κ²μ„ μ‹μ‘λ¶€ν„° μ£Όν–‰ μµμ„± μ„ νƒκΉμ§€μ ν”λ΅μ° μ™„μ„±

#### 2.1 κ²μ„ μ‹μ‘ ν•¨μ
- [ ] `startGame` - κ²μ„ μ‹μ‘
  - λ¨λ“  ν”λ μ΄μ–΄ `isReady` ν™•μΈ
  - λ£Έ μƒνƒλ¥Ό `waiting` β†’ `runStyleSelection`μΌλ΅ λ³€κ²½
  - μ΄κΈ° λ¥λ ¥μΉ μƒμ„± (speed, stamina, condition, jockeySkill)
  - κ° ν”λ μ΄μ–΄μ—κ² λλ¤ μ£Όν–‰ μµμ„± 3κ° μ μ‹

#### 2.2 μ£Όν–‰ μµμ„± μ„ νƒ ν•¨μ
- [ ] `selectRunStyle` - ν”λ μ΄μ–΄ μ£Όν–‰ μµμ„± μ„ νƒ μ²λ¦¬
  - μ„ νƒν• μµμ„± μ €μ¥
  - λ¨λ“  ν”λ μ΄μ–΄ μ„ νƒ μ™„λ£ ν™•μΈ
  - λ¨λ“  ν”λ μ΄μ–΄ μ„ νƒ μ™„λ£ μ‹ μλ™μΌλ΅ `augmentSelection` λ‹¨κ³„λ΅ μ „ν™

#### 2.3 λ¥λ ¥μΉ μ΄κΈ°ν™” λ΅μ§
- [ ] κΈ°λ³Έ λ¥λ ¥μΉ μƒμ„± ν•¨μ
  - `speed`: 60-120 λλ¤
  - `stamina`: 60-120 λλ¤
  - `condition`: 40-100 λλ¤
  - `jockeySkill`: 50-100 λλ¤

**μμƒ μ†μ” μ‹κ°„**: 1μ£Ό

---

### Phase 3: μ¦κ°• μ‹μ¤ν… κµ¬ν„ (3-4μ£Όμ°¨)

**λ©ν‘**: μ¦κ°• μΉ΄λ“ μƒμ„±, μ„ νƒ, λ¦¬λ΅¤ κΈ°λ¥ μ™„μ„±

#### 3.1 μ¦κ°• μΉ΄λ“ λ°μ΄ν„° μ •μ
- [ ] μ¦κ°• μΉ΄λ“ λ°μ΄ν„°λ² μ΄μ¤ μƒμ„± (`functions/src/data/augments.ts`)
  - λ μ–΄λ„λ³„ ν™•λ¥  μ •μ
  - μΉ΄ν…κ³ λ¦¬λ³„ ν¨κ³Ό μ •μ
  - λ‹¤κµ­μ–΄ μ§€μ›μ„ μ„ν• κµ¬μ΅° μ„¤κ³„

#### 3.2 μ¦κ°• μƒμ„± ν•¨μ
- [ ] `generateAugments` - μ„ΈνΈλ³„ μ¦κ°• μΉ΄λ“ μƒμ„±
  - λ¨λ“  ν”λ μ΄μ–΄μ—κ² λ™μΌ λ μ–΄λ„ μ΅°ν•© λ³΄μ¥
  - λ μ–΄λ„ ν™•λ¥  μ μ© (Common 70%, Rare 25%, Epic 5%)
  - μ„ΈνΈλ³„ μ¦κ°• μΉ΄λ“ μ €μ¥ (`rooms/{roomId}/sets/{setId}`)

#### 3.3 μ¦κ°• μ„ νƒ ν•¨μ
- [ ] `selectAugment` - ν”λ μ΄μ–΄ μ¦κ°• μ„ νƒ μ²λ¦¬
  - μ„ νƒν• μ¦κ°• μ €μ¥
  - λ¨λ“  ν”λ μ΄μ–΄ μ„ νƒ μ™„λ£ ν™•μΈ
  - λ¨λ“  ν”λ μ΄μ–΄ μ„ νƒ μ™„λ£ μ‹ μλ™μΌλ΅ `racing` λ‹¨κ³„λ΅ μ „ν™

#### 3.4 μ¦κ°• λ¦¬λ΅¤ ν•¨μ
- [ ] `rerollAugments` - μ¦κ°• μƒλ΅κ³ μΉ¨ μ²λ¦¬
  - λ¦¬λ΅¤ νμ μ°¨κ° (`rerollUsed` μ¦κ°€)
  - μƒλ΅μ΄ μ¦κ°• μΉ΄λ“ 3μ¥ μƒμ„± (λ™μΌ λ μ–΄λ„ μ΅°ν•©)
  - λ¦¬λ΅¤ νμ λ¶€μ΅± μ‹ μ—λ¬ λ°ν™

#### 3.5 μ¦κ°• ν¨κ³Ό μ μ© λ΅μ§
- [ ] μ¦κ°• ν¨κ³Ό κ³„μ‚° ν•¨μ
  - λ¥λ ¥μΉ κ³„μ‚° μ‹ μ¦κ°• ν¨κ³Ό μ μ©
  - μ—¬λ¬ μ¦κ°• ν¨κ³Ό μ¤‘μ²© μ²λ¦¬

**μμƒ μ†μ” μ‹κ°„**: 1-2μ£Ό

---

### Phase 4: λ μ΄μ¤ μ‹λ®¬λ μ΄μ… (4-5μ£Όμ°¨)

**λ©ν‘**: λ μ΄μ¤ μ‹λ®¬λ μ΄μ… λ΅μ§ κµ¬ν„ λ° κ²°κ³Ό κ³„μ‚°

#### 4.1 λ μ΄μ¤ μ‹μ‘ ν•¨μ
- [ ] `startRace` - λ μ΄μ¤ μ‹μ‘
  - λ£Έ μƒνƒλ¥Ό `augmentSelection` β†’ `racing`μΌλ΅ λ³€κ²½
  - λ¨λ“  ν”λ μ΄μ–΄μ μµμΆ… λ¥λ ¥μΉ κ³„μ‚° (μ¦κ°• ν¨κ³Ό μ μ©)
  - λ μ΄μ¤ μ‹λ®¬λ μ΄μ… νΈλ¦¬κ±°

#### 4.2 λ μ΄μ¤ μ‹λ®¬λ μ΄μ… λ΅μ§
- [ ] `simulateRace` - λ μ΄μ¤ μ‹λ®¬λ μ΄μ… μ‹¤ν–‰
  - **λ¥λ ¥μΉ κ³„μ‚°**
    - μ¦κ°• ν¨κ³Ό μ μ©
    - μ»¨λ””μ… λ³΄μ • μ μ© (κµ¬κ°„λ³„ λ³΄λ„μ¤/ν¨λ„ν‹°)
  - **μ£Όν–‰ μµμ„±λ³„ μ‘μ „ μ„±κ³µλ¥  κ³„μ‚°**
    - μ»¨λ””μ… κµ¬κ°„λ³„ λ³΄μ •
    - κΈ°μ λ¥λ ¥μΉ λ³΄μ •
  - **μ§€κµ¬λ ¥ νλ³µ λ΅μ§**
    - μ§€κµ¬λ ¥ 0 μ΄ν• μ‹ μ†λ„ 50% κ°μ†
    - νλ³µλ‰ κ³„μ‚° (`baseRecovery + jockeySkillBonus`)
    - κ°€μ†λ„ κ³„μ‚° (`baseAccel * (1 + jockeySkillBonus)`)
  - **Tick λ‹¨μ„ μ‹λ®¬λ μ΄μ…**
    - κ° tickλ§λ‹¤ μ„μΉ μ—…λ°μ΄νΈ
    - μ‘μ „ μ„±κ³µ/μ‹¤ν¨ μ²λ¦¬
    - μ§€κµ¬λ ¥ μ†λ¨ λ° νλ³µ
  - **μµμΆ… μμ„ λ° κΈ°λ΅ κ³„μ‚°**
    - μ™„μ£Ό μ‹κ°„ κ³„μ‚°
    - μμ„ κ²°μ •

#### 4.3 λ μ΄μ¤ κ²°κ³Ό μ €μ¥
- [ ] λ μ΄μ¤ κ²°κ³Όλ¥Ό Firestoreμ— μ €μ¥
  - `rooms/{roomId}/sets/{setId}`μ— `raceResult` μ €μ¥
  - κ° ν”λ μ΄μ–΄μ `raceResults` λ°°μ—΄μ— μ¶”κ°€
  - λ£Έ μƒνƒλ¥Ό `racing` β†’ `setResult`λ΅ λ³€κ²½

**μ°Έκ³  λ¬Έμ„**: 
- `docs/ability-and-augment-design.md` - λ¥λ ¥μΉ λ° μ¦κ°• μ‹μ¤ν… μ„¤κ³„
- `docs/phaser-race-simulation-guide.md` - λ μ΄μ¤ μ‹λ®¬λ μ΄μ… κ°€μ΄λ“

**μμƒ μ†μ” μ‹κ°„**: 2μ£Ό

---

### Phase 5: μ„ΈνΈ μ§„ν–‰ λ° κ²μ„ μΆ…λ£ (5μ£Όμ°¨)

**λ©ν‘**: μ„ΈνΈ μ§„ν–‰, κ²μ„ μΆ…λ£ μ²λ¦¬

#### 5.1 μ„ΈνΈ μ§„ν–‰ ν•¨μ
- [ ] `nextSet` - λ‹¤μ μ„ΈνΈ μ§„ν–‰
  - ν„μ¬ μ„ΈνΈκ°€ λ§μ§€λ§‰ μ„ΈνΈμΈμ§€ ν™•μΈ
  - λ§μ§€λ§‰ μ„ΈνΈκ°€ μ•„λ‹λ©΄:
    - `currentSet` μ¦κ°€
    - μƒλ΅μ΄ μ¦κ°• μΉ΄λ“ μƒμ„± (`generateAugments`)
    - λ£Έ μƒνƒλ¥Ό `setResult` β†’ `augmentSelection`μΌλ΅ λ³€κ²½
  - λ§μ§€λ§‰ μ„ΈνΈλ©΄:
    - `finishGame` νΈμ¶

#### 5.2 κ²μ„ μΆ…λ£ ν•¨μ
- [ ] `finishGame` - κ²μ„ μΆ…λ£ μ²λ¦¬
  - μµμΆ… μμ„ κ³„μ‚° (λ¨λ“  μ„ΈνΈ κ²°κ³Ό ν•©μ‚°)
  - λ£Έ μƒνƒλ¥Ό `setResult` β†’ `finished`λ΅ λ³€κ²½
  - `finishedAt` νƒ€μ„μ¤νƒ¬ν”„ μ €μ¥

#### 5.3 μ„ΈνΈ μ¤ν‚µ ν•¨μ
- [ ] `skipSet` - μ„ΈνΈ μ¤ν‚µ (μ„ νƒμ‚¬ν•­)
  - νΈμ¤νΈλ§ κ°€λ¥
  - ν„μ¬ μ„ΈνΈλ¥Ό μ¤ν‚µν•κ³  λ‹¤μ μ„ΈνΈλ΅ μ§„ν–‰

**μμƒ μ†μ” μ‹κ°„**: 1μ£Ό

---

### Phase 6: μµμ ν™” λ° ν…μ¤νΈ (6μ£Όμ°¨)

**λ©ν‘**: μ„±λ¥ μµμ ν™”, μ—λ¬ μ²λ¦¬ κ°•ν™”, ν…μ¤νΈ

#### 6.1 μ—λ¬ μ²λ¦¬ κ°•ν™”
- [ ] λ¨λ“  ν•¨μμ— λ…ν™•ν• μ—λ¬ λ©”μ‹μ§€
- [ ] μ—λ¬ λ΅κΉ… κ°μ„ 
- [ ] ν΄λΌμ΄μ–ΈνΈ μΉν™”μ μΈ μ—λ¬ μ‘λ‹µ

#### 6.2 μ„±λ¥ μµμ ν™”
- [ ] Firestore μΏΌλ¦¬ μµμ ν™”
- [ ] λ¶ν•„μ”ν• μ½κΈ°/μ“°κΈ° μµμ†ν™”
- [ ] λ°°μΉ μ‘μ—… μµμ ν™”

#### 6.3 ν…μ¤νΈ
- [ ] Firebase Emulatorλ¥Ό ν™μ©ν• ν†µν•© ν…μ¤νΈ
- [ ] κ° ν•¨μλ³„ λ‹¨μ„ ν…μ¤νΈ
- [ ] μ—λ¬ μΌ€μ΄μ¤ μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ
- [ ] λ™μ‹μ„± ν…μ¤νΈ (μ—¬λ¬ ν”λ μ΄μ–΄ λ™μ‹ μ•΅μ…)

#### 6.4 λ¬Έμ„ν™”
- [ ] κ° ν•¨μμ API λ¬Έμ„ν™”
- [ ] λ°μ΄ν„° λ¨λΈ λ¬Έμ„ν™”
- [ ] μ‹λ®¬λ μ΄μ… λ΅μ§ λ¬Έμ„ν™”

**μμƒ μ†μ” μ‹κ°„**: 1μ£Ό

---

## π“ μ „μ²΄ νƒ€μ„λΌμΈ

```
Week 1-2: Phase 1 (κΈ°λ³Έ μΈν”„λΌ λ° λ£Έ κ΄€λ¦¬)
Week 2-3: Phase 2 (κ²μ„ μ‹μ‘ λ° μ£Όν–‰ μµμ„± μ„ νƒ)
Week 3-4: Phase 3 (μ¦κ°• μ‹μ¤ν… κµ¬ν„)
Week 4-5: Phase 4 (λ μ΄μ¤ μ‹λ®¬λ μ΄μ…)
Week 5:   Phase 5 (μ„ΈνΈ μ§„ν–‰ λ° κ²μ„ μΆ…λ£)
Week 6:   Phase 6 (μµμ ν™” λ° ν…μ¤νΈ)
```

**μ΄ μμƒ μ†μ” μ‹κ°„**: 6μ£Ό

---

## π”‘ ν•µμ‹¬ κµ¬ν„ ν¬μΈνΈ

### 1. μƒνƒ μ „ν™ λ΅μ§
```
waiting β†’ runStyleSelection: startGame νΈμ¶, λ¨λ“  ν”λ μ΄μ–΄ ready
runStyleSelection β†’ augmentSelection: λ¨λ“  ν”λ μ΄μ–΄κ°€ μ£Όν–‰ μµμ„± μ„ νƒ μ™„λ£
augmentSelection β†’ racing: λ¨λ“  ν”λ μ΄μ–΄κ°€ μ¦κ°• μ„ νƒ μ™„λ£
racing β†’ setResult: λ μ΄μ¤ μ‹λ®¬λ μ΄μ… μ™„λ£
setResult β†’ augmentSelection: nextSet νΈμ¶ (currentSet < setCount)
setResult β†’ finished: finishGame νΈμ¶ (currentSet === setCount)
```

### 2. λ°μ΄ν„° λ¬΄κ²°μ„±
- λ¨λ“  μƒνƒ μ „ν™μ€ κ²€μ¦ λ΅μ§ ν¬ν•¨
- νΈμ¤νΈ κ¶ν• κ²€μ¦ ν•„μ
- ν”λ μ΄μ–΄ μ μ ν• κ²€μ¦
- κ²μ„ μ§„ν–‰ μ¤‘ λ£Έ μ„¤μ • λ³€κ²½ λ¶κ°€

### 3. κ³µμ •μ„± λ³΄μ¥
- λ¨λ“  ν”λ μ΄μ–΄μ—κ² λ™μΌ λ μ–΄λ„ μ΅°ν•©μ μ¦κ°• μ κ³µ
- λ¦¬λ΅¤ νμλ” κ³µν†µ λ¦¬μ†μ¤λ΅ κ΄€λ¦¬
- λ¥λ ¥μΉ μ΄κΈ°κ°’μ€ λλ¤μ΄μ§€λ§ λ²”μ„ λ‚΄μ—μ„ κ³µμ •ν•κ²

### 4. μ‹¤μ‹κ°„ λ™κΈ°ν™”
- Firestore λ¦¬μ¤λ„λ΅ μ‹¤μ‹κ°„ μƒνƒ μ—…λ°μ΄νΈ
- μƒνƒ λ³€κ²½ μ‹ μλ™μΌλ΅ λ‹¤μ λ‹¨κ³„λ΅ μ „ν™
- ν”λ μ΄μ–΄ μ•΅μ… μ™„λ£ μ‹ μ¦‰μ‹ λ°μ

---

## π“ λ‹¤μ μ‘μ—… μ°μ„ μμ„

### μ¦‰μ‹ μ‹μ‘ν•  μ‘μ—… (Phase 1)
1. `leaveRoom` ν•¨μ κµ¬ν„
2. `updateRoomSettings` ν•¨μ κµ¬ν„
3. Firestore λ³΄μ• κ·μΉ™ μ™„μ„±
4. λ¨λ“  ν•¨μμ— Zod κ²€μ¦ μ¶”κ°€

### λ‹¤μ λ‹¨κ³„ (Phase 2)
1. `startGame` ν•¨μ κµ¬ν„
2. `selectRunStyle` ν•¨μ κµ¬ν„
3. λ¥λ ¥μΉ μ΄κΈ°ν™” λ΅μ§

---

## π“ μ°Έκ³  λ¬Έμ„

- `docs/work-division.md` - μ „μ²΄ μ—…λ¬΄ λ¶„λ‹΄ κ°€μ΄λ“
- `docs/ability-and-augment-design.md` - λ¥λ ¥μΉ λ° μ¦κ°• μ‹μ¤ν… μ„¤κ³„
- `docs/phaser-race-simulation-guide.md` - λ μ΄μ¤ μ‹λ®¬λ μ΄μ… κ°€μ΄λ“
- `docs/backend-development-guide.md` - λ°±μ—”λ“ κ°λ° κ°€μ΄λ“
- `docs/backend-usage-examples.md` - λ°±μ—”λ“ μ‚¬μ© μμ‹

---

## μ—…λ°μ΄νΈ μ΄λ ¥

- 2024-11-21: μ΄μ• μ‘μ„± (work-division.md κΈ°λ°)

